<!DOCTYPE html>
<html lang="ru" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Мой профиль - MikhailPoizon</title>
    <link rel="stylesheet" th:href="@{/css/profile.css}">
    <link rel="stylesheet" th:href="@{/css/profile_page.css}">
    <link rel="stylesheet" href="/css/profile.css">
    <link rel="stylesheet" href="/css/profile_page.css">
</head>
<body>

    <header class="header">
        
            <div class="flex items-center gap-4">
                <h1 class="header-logo">MikhailPoizon</h1>
            </div>
            
            <div class="header-actions">
                <button class="btn-ghost notification-btn">
                    <svg class="icon" viewBox="0 0 24 24">
                        <path d="M15 17h5l-1.405-1.405A2.032 2.032 0 0118 14.158V11a6.002 6.002 0 00-4-5.659V5a2 2 0 10-4 0v.341C7.67 6.165 6 8.388 6 11v3.159c0 .538-.214 1.055-.595 1.436L4 17h5m6 0v1a3 3 0 11-6 0v-1m6 0H9"/>
                    </svg>
                    <span class="notification-dot"></span>
                </button>

                <div class="mobile-auth flex items-center gap-3">
                    <a href="/auth/login"><button class="btn btn-outline">Войти</button></a>
                    <a href="/auth/register"><button class="btn btn-primary">Регистрация</button></a>
                </div>
                
                <div class="dropdown">
                    <button class="btn-ghost flex items-center gap-2" id="profileButton">
                        <div class="profile-avatar">
                            <svg class="icon-sm text-black" viewBox="0 0 24 24">
                                <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                            </svg>
                        </div>
                        <span class="text-gray-700">Клиент</span>
                        <svg class="icon-sm text-gray-500" viewBox="0 0 24 24">
                            <path d="M19 9l-7 7-7-7"/>
                        </svg>
                    </button>
                    
                    <div class="dropdown-content" id="dropdownContent">
                        <a href="/profile" class="dropdown-item">
                           
                            <span>Мой профиль</span>
                        </a>
                        <a href="/settings" class="dropdown-item">
                            
                            <span>Настройки</span>
                        </a>
                        <div class="dropdown-separator"></div>
                        <div class="mobile-auth-dropdown">
                            <a href="/auth/login" class="dropdown-item">Войти</a>
                            <a href="/auth/register" class="dropdown-item">Регистрация</a>
                            <div class="dropdown-separator"></div>
                        </div>
                        <a href="/auth/logout" class="dropdown-item text-red-600">
                           
                            <span>Выйти</span>
                        </a>
                    </div>
                </div>
            </div>
        </header>
    <div class="overlay" id="overlay"></div>

    <!-- Mobile Header -->
    <div class="mobile-header">
        <div class="mobile-header-content">
            <button class="btn btn-ghost" id="menuBtn">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M3 12h18M3 6h18M3 18h18"/>
                </svg>
            </button>
            <h1>Мой профиль</h1>
            <button class="btn btn-ghost" onclick="goHome()">
                <svg class="icon" viewBox="0 0 24 24">
                    <path d="M19 12H5M12 19l-7-7 7-7"/>
                </svg>
            </button>
        </div>
    </div>

    <div class="container">
        <!-- Desktop Header -->
        <div class="desktop-header">
            <h1>Мой профиль</h1>
            <div class="title-underline"></div>
        </div>

        <!-- Main Layout -->
        <div class="main-layout">
            <!-- Desktop Sidebar -->
            <div class="sidebar-desktop">
                <div class="control-panel">
                    <nav class="nav-menu">
                        <a href="/profile" class="nav-item">
                            <svg class="nav-icon" viewBox="0 0 24 24">
                                        <path d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                            <span>Профиль</span>
                        </a>
                        <a href="/feed" class="nav-item">
                            <svg class="nav-icon" viewBox="0 0 24 24">
                                        <path d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9.5a2 2 0 00-2-2h-2m-4-3v9"/>
                                    </svg>
                            <span>Новости</span>
                        </a>
                        <a href="/order" class="nav-item">
                            <svg class="nav-icon" viewBox="0 0 24 24">
                                        <path d="M3 3h2l.4 2M7 13h10l4-8H5.4m0 0L7 13m0 0l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17"/>
                                        <circle cx="9" cy="20" r="1"/>
                                        <circle cx="20" cy="20" r="1"/>
                                    </svg>
                            <span>Заказать</span>
                        </a>
                        <a href="/calculator" class="nav-item">
                            <svg class="nav-icon" viewBox="0 0 24 24">
                                        <path d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z"/>
                                    </svg>
                            <span>Калькулятор</span>
                        </a>
                        <a href="/my-orders" class="nav-item">
                            <svg class="nav-icon" viewBox="0 0 24 24">
                                        <path d="M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"/>
                                    </svg>
                            <span>Мои заказы</span>
                        </a>
                        <a href="/reviews" class="nav-item">
                            <svg class="nav-icon" viewBox="0 0 24 24">
                                        <path d="M11.049 2.927c.3-.921 1.603-.921 1.902 0l1.519 4.674a1 1 0 00.95.69h4.915c.969 0 1.371 1.24.588 1.81l-3.976 2.888a1 1 0 00-.363 1.118l1.518 4.674c.3.922-.755 1.688-1.538 1.118l-3.976-2.888a1 1 0 00-1.176 0l-3.976 2.888c-.783.57-1.838-.197-1.538-1.118l1.518-4.674a1 1 0 00-.363-1.118l-3.976-2.888c-.784-.57-.38-1.81.588-1.81h4.914a1 1 0 00.951-.69l1.519-4.674z"/>
                                    </svg>
                            <span>Отзывы</span>
                        </a>
                    </nav>
                    <div class="nav-separator">
                        <a href="/auth/logout" class="nav-item nav-logout">
                            <svg class="icon transition-colors" viewBox="0 0 24 24">
                                        <path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/>
                                        <polyline points="16,17 21,12 16,7"/>
                                        <line x1="21" y1="12" x2="9" y2="12"/>
                                    </svg>
                            Выйти
                        </a>
                    </div>
                </div>
            </div>

            <!-- Main Content -->
            <div class="main-content">
                <form th:action="@{/profile/update}" th:object="${user}" method="post">
                <div class="content-sections">
                    <!-- Основная информация -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Основная информация</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="username" class="form-label">Имя пользователя*</label>
                                    <input type="text" id="username" class="form-input" th:field="*{username}">
                                </div>
                                <div class="form-group">
                                    <label for="tgUsername" class="form-label">Telegram username</label>
                                    <input type="text" id="tgUsername" class="form-input" value="tg-user">
                                </div>
                                <div class="form-group">
                                    <label for="birthDate" class="form-label">Дата рождения</label>
                                    <input type="date" id="birthDate" class="form-input" value="2000-02-03">
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Адрес -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">Адрес</h2>
                        </div>
                        <div class="card-content">
                            <div class="form-grid">
                                <div class="form-group">
                                    <label for="city" class="form-label">Город*</label>
                                    <div class="input-with-clear">
                                        <input type="text" id="city" class="form-input" value="Москва">
                                        <button type="button" class="btn-clear" onclick="clearInput('city')">
                                            <svg class="icon-sm" viewBox="0 0 24 24">
                                                <path d="M18 6 6 18M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="street" class="form-label">Улица</label>
                                    <div class="input-with-clear">
                                        <input type="text" id="street" class="form-input" value="ул. Дорожная">
                                        <button type="button" class="btn-clear" onclick="clearInput('street')">
                                            <svg class="icon-sm" viewBox="0 0 24 24">
                                                <path d="M18 6 6 18M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="house" class="form-label">Дом</label>
                                    <div class="input-with-clear">
                                        <input type="text" id="house" class="form-input" value="14к1">
                                        <button type="button" class="btn-clear" onclick="clearInput('house')">
                                            <svg class="icon-sm" viewBox="0 0 24 24">
                                                <path d="M18 6 6 18M6 6l12 12"/>
                                            </svg>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="card">
                        <div class="card-header">
                            <h2 class="card-title">E-mail</h2>
                        </div>
                        <div class="card-content">
                            <!-- Подтвержденный email -->
                            <div th:if="${user.verify_code == null}">
                                <div class="email-row" style="margin-bottom: 1.5rem;">
                                    <span th:field="*{email}"></span>
                                    <svg class="status-icon status-verified" viewBox="0 0 24 24">
                                        <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                                        <polyline points="22,4 12,14.01 9,11.01"/>
                                    </svg>
                                </div>
                            </div>

                            <!-- Неподтвержденный email -->
                            <div th:if="${user.verify_code != null}">
                                <form method="post" th:action="@{/profile/send-confirm-mail}" th:object="${user}">
                                    <div id="emailSection">
                                        <div id="emailDisplay">
                                            <div class="email-row">
                                                <span id="currentEmail" th:field="*{email}"></span>
                                                <svg class="status-icon status-unverified" viewBox="0 0 24 24">
                                                    <circle cx="12" cy="12" r="10"/>
                                                    <path d="m15 9-6 6M9 9l6 6"/>
                                                </svg>
                                                <span class="email-status">E-mail не подтвержден</span>
                                            </div>
                                            <p class="email-description">
                                                Ваш E-mail не подтвержден
                                            </p>
                                            <div class="email-actions">
                                                <button class="btn btn-accent" type="button" onclick="editEmail()">Изменить</button>
                                                <button class="btn btn-accent" type="submit">Подтвердить</button>
                                            </div>
                                        </div>

                                        <div id="emailEdit" style="display: none;">
                                            <div class="email-row">
                                                <input type="email" id="emailInput" class="form-input email-edit-input">
                                                <svg class="status-icon status-unverified" viewBox="0 0 24 24">
                                                    <circle cx="12" cy="12" r="10"/>
                                                    <path d="m15 9-6 6M9 9l6 6"/>
                                                </svg>
                                            </div>
                                            <p class="email-description">
                                                Ваш E-mail не подтвержден
                                            </p>
                                            <div class="email-actions">
                                                <button class="btn btn-accent" type="submit">Подтвердить</button>
                                                <button class="btn btn-ghost" onclick="cancelEmailEdit()">Отмена</button>
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>

                    <!-- Изменение пароля -->
<!--                    <div class="card">-->
<!--                        <div class="card-header">-->
<!--                            <h2 class="card-title">Изменить пароль</h2>-->
<!--                        </div>-->
<!--                        <div class="card-content">-->
<!--                            <div class="form-grid" style="grid-template-columns: 1fr;">-->
<!--                                <div class="form-group">-->
<!--                                    <label for="currentPassword" class="form-label">Текущий пароль*</label>-->
<!--                                    <div class="password-input-container">-->
<!--                                        <input type="password" id="currentPassword" class="form-input password-input" placeholder="Введите текущий пароль">-->
<!--                                        <button type="button" class="password-toggle" onclick="togglePassword('currentPassword')">-->
<!--                                            <svg class="password-icon" viewBox="0 0 24 24" id="currentPassword-show">-->
<!--                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>-->
<!--                                                <circle cx="12" cy="12" r="3"/>-->
<!--                                            </svg>-->
<!--                                            <svg class="password-icon" viewBox="0 0 24 24" id="currentPassword-hide" style="display: none;">-->
<!--                                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>-->
<!--                                                <path d="M1 1 23 23"/>-->
<!--                                            </svg>-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                </div>-->

<!--                                <div class="form-group">-->
<!--                                    <label for="newPassword" class="form-label">Новый пароль*</label>-->
<!--                                    <div class="password-input-container">-->
<!--                                        <input type="password" id="newPassword" class="form-input password-input" placeholder="Введите новый пароль (минимум 8 символов)" oninput="validateNewPassword()">-->
<!--                                        <button type="button" class="password-toggle" onclick="togglePassword('newPassword')">-->
<!--                                            <svg class="password-icon" viewBox="0 0 24 24" id="newPassword-show">-->
<!--                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>-->
<!--                                                <circle cx="12" cy="12" r="3"/>-->
<!--                                            </svg>-->
<!--                                            <svg class="password-icon" viewBox="0 0 24 24" id="newPassword-hide" style="display: none;">-->
<!--                                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>-->
<!--                                                <path d="M1 1 23 23"/>-->
<!--                                            </svg>-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                    <p id="newPasswordError" class="password-error" style="display: none;">-->
<!--                                        Пароль должен содержать минимум 8 символов-->
<!--                                    </p>-->
<!--                                </div>-->

<!--                                <div class="form-group">-->
<!--                                    <label for="confirmPassword" class="form-label">Подтвердите новый пароль*</label>-->
<!--                                    <div class="password-input-container">-->
<!--                                        <input type="password" id="confirmPassword" class="form-input password-input" placeholder="Повторите новый пароль" oninput="validatePasswordMatch()">-->
<!--                                        <button type="button" class="password-toggle" onclick="togglePassword('confirmPassword')">-->
<!--                                            <svg class="password-icon" viewBox="0 0 24 24" id="confirmPassword-show">-->
<!--                                                <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>-->
<!--                                                <circle cx="12" cy="12" r="3"/>-->
<!--                                            </svg>-->
<!--                                            <svg class="password-icon" viewBox="0 0 24 24" id="confirmPassword-hide" style="display: none;">-->
<!--                                                <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>-->
<!--                                                <path d="M1 1 23 23"/>-->
<!--                                            </svg>-->
<!--                                        </button>-->
<!--                                    </div>-->
<!--                                    <p id="confirmPasswordError" class="password-error" style="display: none;">-->
<!--                                        Пароли не совпадают-->
<!--                                    </p>-->
<!--                                </div>-->
<!--                            </div>-->

<!--                            <div style="display: flex; justify-content: flex-end; margin-top: 1.5rem;">-->
<!--                                <button id="changePasswordBtn" class="btn" -->
<!--                                        style="background-color: var(&#45;&#45;accent); color: var(&#45;&#45;accent-foreground);" -->
<!--                                        onclick="changePassword()" disabled>-->
<!--                                    Изменить пароль-->
<!--                                </button>-->
<!--                            </div>-->
<!--                        </div>-->
<!--                    </div>-->

                    <!-- Action Buttons -->
                    <div class="action-buttons">
                        <button class="btn btn-secondary" onclick="goHome()">
                            Отмена
                        </button>
                        <button class="btn btn-primary" type="submit">
                            Сохранить
                        </button>
                        <br></br>
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>
    <script type="text/javascript" th:src="@{/js/profile.js}"></script>
    <script type="text/javascript" src="/js/profile.js"></script>
</body>
</html>